<p-confirmDialog></p-confirmDialog>
<div #host>
<h1 class="text-center">Liste des produits</h1>

@if (authService.isLoggedIn() && authService.isAdmin()) {
  <p-button
    label="Cr√©er produit"
    (onClick)="onCreate()"
    class="block text-center mb-3"
  />
}
    <p-dataView #dv [value]="products()">
    <ng-template pTemplate="list" let-products>
        @for (product of products; track product) {
        <p-card class="block mb-3">
            
    <!-- Product Image -->
        <div
        class="relative overflow-hidden rounded-xl shadow-sm bg-gray-50 group flex items-center justify-center"
        style="height: 220px; width: 320px;"
        >
        <img
            [src]="product.image"
            alt="{{ product.name }}"
            class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
        />

        <!-- Stock badge -->
        <span
            class="absolute top-2 left-2 text-xs font-semibold px-2 py-1 rounded-md text-white"
            [class.bg-green-500]="product.inventoryStatus === 'INSTOCK'"
            [class.bg-orange-400]="product.inventoryStatus === 'LOWSTOCK'"
            [class.bg-red-500]="product.inventoryStatus === 'OUTOFSTOCK'"
        >
            {{ formatInventoryStatus(product.inventoryStatus) }}
        </span>
        </div>


            <!-- Cat√©gorie -->
            <span class="font-medium text-secondary text-sm">
            {{ product.category }}
            </span>

            <!-- Nom -->
            <div class="text-lg font-medium text-900 mt-2">
            {{ product.name }}
            </div>

            <!-- Description -->
            <p class="text-sm text-700 mt-2 mb-2">
            {{ product.description }}
            </p>

            <!-- Prix + Stock -->
            <div class="flex justify-content-between align-items-center mt-2">
            <div>
                <span class="font-semibold text-900">Prix :</span>
                <span>{{ product.price }} ‚Ç¨</span>
            </div>

            <div>
                <span class="font-semibold text-900">Stock :</span>
                <span
                [class.text-green-500]="product.inventoryStatus === 'INSTOCK'"
                [class.text-orange-500]="product.inventoryStatus === 'LOWSTOCK'"
                [class.text-red-500]="product.inventoryStatus === 'OUTOFSTOCK'"
                >
                {{ formatInventoryStatus(product.inventoryStatus) }}
                </span>
            </div>
            </div>

            <!-- Note -->
            <div class="mt-2">
            <span class="font-semibold text-900">Note :</span>
            <span>
                @for (i of [].constructor(product.rating); track i) {
                ‚≠ê
                }
            </span>
            </div>

            <ng-template pTemplate="footer">
            <div class="flex gap-2 flex-wrap mt-3 justify-content-between">
                
                <!-- Boutons publics -->
                <div class="flex gap-2">
                    <div class="quantity-container">
                        <label class="quantity-label">Quantit√©</label>
                        <p-inputNumber
                          [(ngModel)]="quantities[product.id]"
                          [min]="1"
                          [max]="product.quantity"
                          [showButtons]="true"
                          buttonLayout="horizontal"
                          incrementButtonIcon="pi pi-plus"
                          decrementButtonIcon="pi pi-minus"
                          inputStyleClass="quantity-input"
                          styleClass="quantity-selector"
                          decrementButtonClass="quantity-btn"
                          incrementButtonClass="quantity-btn"
                          [ngModelOptions]="{ standalone: true }"
                          [ngModel]="quantities[product.id] || 1"
                          (ngModelChange)="quantities[product.id] = $event"
                        ></p-inputNumber>
                      </div>
                  
                <p-button
                    label="üõí Ajouter au panier"
                    severity="success"
                    (onClick)="onAddToCart(product)"
                />
                <p-button
                    [label]="wishlistService.isFavorite(product.id) ? 'üíî Retirer' : '‚ù§Ô∏è Favori'"
                    [severity]="wishlistService.isFavorite(product.id) ? 'danger' : 'help'"
                    (onClick)="onAddToFavorites(product)"
                />

                </div>

                <!-- Boutons admin -->
                @if (authService.isLoggedIn() && authService.isAdmin()) {
                <div class="flex gap-2">
                    <p-button
                    label="Modifier"
                    severity="secondary"
                    (onClick)="onUpdate(product)"
                    />
                    <p-button
                    label="Supprimer"
                    severity="danger"
                    (onClick)="onDelete(product)"
                    />
                </div>
                }
            </div>
            </ng-template>

        </p-card>
        }
    </ng-template>
    </p-dataView>
<p-paginator
  [first]="currentPage() * rows()"
  [rows]="rows()"
  [totalRecords]="totalRecords()"
  [rowsPerPageOptions]="[5,10,25,50]"
  (onPageChange)="onPageChange($event)"
  styleClass="mt-4 flex justify-center"
/>

<p-dialog
  [(visible)]="isDialogVisible"
  [style]="{ width: '50vw' }"
  header="Ajout/√âdition produit"
>
  <app-product-form
    [product]="editedProduct()"
    (save)="onSave($event)"
    (cancel)="onCancel()"
  />
</p-dialog>

</div>
<app-auth-dialog></app-auth-dialog>
